---
# ============================================================================
# Role: software - Task: install_from_support
# Buscar instaladores en PC de soporte e instalar
# ============================================================================
# Variables:
#   support_pc_path: Path de red o local de la PC de soporte
#   app_installer_name: Nombre del instalador (ej: ChromeSetup.exe)
# ============================================================================

- name: Verificar variables de instalación
  fail:
    msg: "Debe proporcionar 'support_pc_path' y 'app_installer_name'"
  when: support_pc_path is not defined or app_installer_name is not defined

- name: Buscar e instalar aplicación
  ansible.windows.win_shell: |
    $path = Join-Path "{{ support_pc_path }}" "{{ app_installer_name }}"
    if (Test-Path $path) {
        Write-Output "Instalador encontrado. Iniciando instalación..."
        if ($path -like "*.msi") {
            Start-Process msiexec.exe -ArgumentList "/i `"$path`" /qn /norestart" -Wait
        } else {
            Start-Process $path -ArgumentList "/S", "/silent" -Wait
        }
        Write-Output "Instalación de {{ app_installer_name }} completada"
    } else {
        Write-Output "ERROR: No se encontró el instalador en $path"
    }
  register: support_install_result

- name: Mostrar resultado de instalación
  debug:
    msg: "{{ support_install_result.stdout }}"
